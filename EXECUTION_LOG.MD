--- MANIFEST 54.1: OPERATION 'TOTAL STATE AUDIT TO LOG' ---

--- 1. Current Git Status ---
On branch work
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   EXECUTION_LOG.MD

no changes added to commit (use "git add" and/or "git commit -a")

--- 2. Auditing Critical File Contents ---

--- [FILE START: render.yaml] ---
services:
  # 1. The Web Service (The "Keep-Alive" Dummy)
  - type: web
    name: vitador-web
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app"
    autoDeploy: true
    envVars:
      - fromGroup: custom1

  # 2. The Worker (The Real Bot)
  - type: worker
    name: manus-analytics-bot
    env: python
    plan: free
    healthCheckPath: /  # Disable HTTP health check
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python run_bot.py"  # The correct command
    autoDeploy: true
    envVars:
      - fromGroup: custom1

--- [FILE END: render.yaml] ---

--- [FILE START: core/config.py] ---
import os
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    """Application-wide settings."""

    # Allow populating settings from a .env file
    model_config = SettingsConfigDict(
        env_file=".env", env_file_encoding="utf-8", extra="ignore"
    )

    # Telegram Bot Credentials
    BOT_TOKEN: str = "YOUR_BOT_TOKEN_HERE"
    ADMIN_USER_ID: int = 0

    # MongoDB Connection Details
    DATABASE_URL: str = "mongodb://localhost:27017/"
    MONGO_DB_NAME: str = "manus_analytics_db"

    # Web App URL for keep-alive service
    WEB_APP_URL: str | None = None

settings = Settings()

--- [FILE END: core/config.py] ---

--- [FILE START: .gitignore] ---
# Environment variables and secrets
.env

# Python bytecode and cache
__pycache__/
*.pyc
*.pyo
*.pyd

# Virtual environment directories
venv/
env/
.venv/

# IDE and editor directories
.idea/
.vscode/
*.swp
*.swo

--- [FILE END: .gitignore] ---

--- [FILE START: main.py] ---
import os
import asyncio
import requests
from fastapi import FastAPI
from threading import Thread
import time

WEB_APP_URL = os.getenv("WEB_APP_URL")
app = FastAPI()

def keep_alive():
    while True:
        try:
            if WEB_APP_URL:
                print(f"Keep-alive: Sending request to {WEB_APP_URL}")
                requests.get(WEB_APP_URL)
                print("Keep-alive: Request sent successfully.")
            else:
                print("Keep-alive: WEB_APP_URL not set. Skipping request.")
        except requests.exceptions.RequestException as e:
            print(f"Keep-alive: Failed to send request: {e}")
        time.sleep(600)

@app.on_event("startup")
async def startup_event():
    print("Application startup: Starting keep-alive thread.")
    thread = Thread(target=keep_alive)
    thread.daemon = True
    thread.start()

@app.get("/")
def read_root():
    return {"status": "Analytics System is Active. Eternal Vigilance."}

--- [FILE END: main.py] ---

--- [FILE START: run_bot.py] ---
import asyncio
from core.database import db_manager
from core.logger import log
from bot.main import start_bot, shutdown_bot

async def main():
    log.info("ðŸš€ Application startup...")
    await db_manager.connect()
    try:
        await start_bot()
    finally:
        await shutdown_bot()
        await db_manager.close()
        log.info("ðŸ›‘ Application shutdown complete.")

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except (KeyboardInterrupt, SystemExit):
        log.info("Application interrupted by user. Shutting down...")

--- [FILE END: run_bot.py] ---

# Manifest 55 Execution Log

## Phase 1: Branch Preparation
# Intent: Create a clean deployment branch for the final fix.
# Action: `git checkout work`, `git branch -D final-deployment`, `git checkout -b final-deployment`.
# Outcome: SUCCESS â€” Branch `final-deployment` created from the latest work state.

## Phase 2: Blueprint Correction
# Intent: Remove the unsupported Render health check directive from the worker service.
# Action: Edited `render.yaml` to delete the `healthCheckPath` line from the worker definition.
# Outcome: SUCCESS â€” `render.yaml` now matches the supported Render configuration.

## Phase 3: Commit Preparation
# Intent: Record the deployment fix for review.
# Action: `git add render.yaml` followed by `git commit -m "fix(deploy): Remove unsupported healthCheckPath from worker"`.
# Outcome: SUCCESS â€” Commit created on `final-deployment` containing the surgical change.
